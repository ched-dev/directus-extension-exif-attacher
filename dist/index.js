"use strict";const e=[{prop:"dateTaken",getValue:e=>{var a;return null===(a=e.exif)||void 0===a?void 0:a.CreateDate}},{prop:"cameraMake",getValue:e=>{var a;return null===(a=e.ifd0)||void 0===a?void 0:a.Make}},{prop:"cameraModel",getValue:e=>{var a;return null===(a=e.ifd0)||void 0===a?void 0:a.Model}},{prop:"iso",getValue:e=>{var a;return null===(a=e.exif)||void 0===a?void 0:a.ISO}},{prop:"exposure",getValue:e=>{var a;return null===(a=e.exif)||void 0===a?void 0:a.ExposureTime}},{prop:"exposureFormatted",getValue:e=>{var a,o;if(null===(a=e.exif)||void 0===a?void 0:a.ExposureTime){const a=null===(o=e.exif)||void 0===o?void 0:o.ExposureTime;return a<1?"1/"+Math.round(1/a):Number(a.toFixed(1))+'"'}return null}},{prop:"aperture",getValue:e=>{var a;return null===(a=e.exif)||void 0===a?void 0:a.FNumber}},{prop:"focalLength",getValue:e=>{var a;return null===(a=e.exif)||void 0===a?void 0:a.FocalLength}},{prop:"focalLengthIn35mm",getValue:e=>{var a;return null===(a=e.exif)||void 0===a?void 0:a.FocalLengthIn35mmFormat}},{prop:"lensMake",getValue:e=>{var a;return null===(a=e.exif)||void 0===a?void 0:a.LensMake}},{prop:"lensModel",getValue:e=>{var a;return null===(a=e.exif)||void 0===a?void 0:a.LensModel}},{prop:"gps",getValue:e=>{var a,o;if((null===(a=e.gps)||void 0===a?void 0:a.longitude)&&(null===(o=e.gps)||void 0===o?void 0:o.latitude)){return{type:"Point",coordinates:[e.gps.longitude,e.gps.latitude]}}return null}}],a=[{name:"media_library",imageFieldKey:"image",exifFields:e}];var o=({filter:o},{services:i})=>{a.map((a=>{const l=((a,o)=>async function(i,l,t){var r;const n=null===(r=t.schema)||void 0===r?void 0:r.collections[o.name],u=o.imageFieldKey||"image",d=i.hasOwnProperty(u)?i[u]:void 0;if(console.log(`${o.name} attachExifData info:`,{item:i,meta:l,collectionSchema:n,imageFieldKey:u,imageId:d}),d){const l=o.exifFields||e;if(l.map((e=>{(null==n?void 0:n.fields.hasOwnProperty(e.prop))&&(i[e.prop]=null)})),a&&a.ItemsService){const e=new a.ItemsService("directus_files",{schema:t.schema}),r=await e.readOne(d);console.log(`${o.name} attachExifData imageInfo:`,{imageInfo:r}),r&&r.metadata&&l.map((e=>{(null==n?void 0:n.fields.hasOwnProperty(e.prop))?i[e.prop]=e.getValue(r.metadata)||null:console.log(`${o.name} attachExifData fieldMissing:`,{fieldProp:e.prop})}))}console.log(`${o.name} attachExifData updated:`,{item:i})}else console.log(`${o.name} attachExifData noImage`);return i})(i,a);o(`${a.name}.items.create`,l),o(`${a.name}.items.update`,l)}))};module.exports=o;
