"use strict";var e=[{prop:"date_taken",getValue:e=>e.exif?.CreateDate},{prop:"camera_make",getValue:e=>e.ifd0?.Make},{prop:"camera_model",getValue:e=>e.ifd0?.Model},{prop:"iso",getValue:e=>e.exif?.ISO},{prop:"exposure",getValue:e=>e.exif?.ExposureTime},{prop:"exposure_formatted",getValue:e=>{if(e.exif?.ExposureTime){const a=e.exif?.ExposureTime;return a<1?"1/"+Math.round(1/a):Number(a.toFixed(1))+'"'}return null}},{prop:"aperture",getValue:e=>e.exif?.FNumber},{prop:"focal_length",getValue:e=>e.exif?.FocalLength},{prop:"focal_length_in_35mm",getValue:e=>e.exif?.FocalLengthIn35mmFormat},{prop:"lens_make",getValue:e=>e.exif?.LensMake},{prop:"lens_model",getValue:e=>e.exif?.LensModel},{prop:"gps",getValue:e=>{if(e.gps?.longitude&&e.gps?.latitude){return{type:"Point",coordinates:[e.gps.longitude,e.gps.latitude]}}return null}}];const a=e,t={WARNING:"THIS FILE IS AUTOMATICALLY GENERATED. DO NOT EDIT.",exif_data_models:[{name:"media_library",fields:["date_taken","camera_make","camera_model","iso","exposure","exposure_formatted","aperture","focal_length","focal_length_in_35mm","lens_make","lens_model","gps"],imageFieldName:"image"}]},o=t&&t.hasOwnProperty("exif_data_models")&&t.exif_data_models;var i={DEBUG:!0,DEFAULT_JSON_CONFIG_FILENAME:"exif-attacher-config.json",DATA_MODELS_CONFIG_PROP:"exif_data_models",EXIF_COLLECTIONS:o.map((e=>({...e,fields:e.fields.map((e=>a.find((a=>a.prop===e))))}))),currentConfig:t,exifDataModels:o};var l=({filter:a},{services:t})=>{i.EXIF_COLLECTIONS.map((o=>{const l=((a,t)=>async function(o,l,r){var n;const m=null===(n=r.schema)||void 0===n?void 0:n.collections[t.name],s=t.imageFieldName||"image",p=o.hasOwnProperty(s)?o[s]:void 0;if(i.DEBUG&&console.log(`${t.name} attachExifData info:`,{item:o,meta:l,collectionSchema:m,imageFieldName:s,imageId:p}),p){const l=t.fields||e;if(l.map((e=>{(null==m?void 0:m.fields.hasOwnProperty(e.prop))&&(o[e.prop]=null)})),a&&a.ItemsService){const e=new a.ItemsService("directus_files",{schema:r.schema}),n=await e.readOne(p);i.DEBUG&&console.log(`${t.name} attachExifData imageInfo:`,{imageInfo:n}),n&&n.metadata&&l.map((e=>{(null==m?void 0:m.fields.hasOwnProperty(e.prop))?o[e.prop]=e.getValue(n.metadata)||null:i.DEBUG&&console.log(`${t.name} attachExifData fieldMissing:`,{fieldProp:e.prop})}))}i.DEBUG&&console.log(`${t.name} attachExifData updated:`,{item:o})}else i.DEBUG&&console.log(`${t.name} attachExifData noImage`);return o})(t,o);a(`${o.name}.items.create`,l),a(`${o.name}.items.update`,l)}))};module.exports=l;
